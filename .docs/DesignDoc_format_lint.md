# DesignDoc: Format and Lint

## Abstract/Summary

- C#
  - Run formatting with `make fmt` script
  - Run linting with `make lint` script
- Unity files
  - Use the format automatically generated by Unity
  - Should not be edited manually

## Proposed Design

### `fmt` and `lint` script (in [`Makefile`](../Makefile))

The `fmt` script runs `dotnet format $(SOLUTION_PATH) --severity error`.
The `lint` script runs `dotnet format $(SOLUTION_PATH) --severity warn --verify-no-changes`.

- `SOLUTION_PATH`: Path to Unity `.slnx` file (default: `unity-mvvm.slnx`)

### [`.editorconfig`](../.editorconfig)

#### C\#

##### Rule Selection

Most common rules listed in [Code-style language and unnecessary code rules - .NET](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/style-rules/language-rules) are included.

C# is a language with many different ways to write the same logic.
In software development, it is better to avoid these variations.
For this reason, many rules are checked.

For rules with two implementation patterns, we chose based on current knowledge.
We will review the choices when we find issues during development.

##### Severity

###### `error`

Rules that can be fixed automatically by the formatter.
Code matching these rules will be **fixed automatically** by the `make fmt` script.

###### `warning`

Rules where automatic fixes could break the code.
Code matching these rules will be **detected** by the `make lint` script and **fixed manually** by developers.

###### Why breaking fixes use `warning` instead of `error`

We use the `dotnet format` command for both formatting and linting. When running with `--severity warn`, it also detects rules with severity `error`.

1. Run with `--severity error` option
   - Detect and fix only rules with severity `error` automatically
2. Run with `--severity warn --verify-no-changes` option
   - Skip rules with severity `error` (already fixed in step 1)
   - Only detect rules with severity `warning` that need manual fixes

※ The `--diagnostics` option does not work for this purpose, so we don't use it.

#### Unity files: `*.{asset,meta,prefab,unity}`

Do not format files generated by Unity.

※ Keep the file format that Unity generates.
